<!DOCTYPE html>
<html>
<head>
<title>Kryptonite Comet - Tilt Gravity Simulator</title>
<style>
    body {
        margin: 0;
        background: black;
        overflow: hidden;
        color: white;
        font-family: sans-serif;
    }
    #toggleGravity {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 10;
        padding: 10px;
        background: rgba(0,0,0,0.6);
        border: 1px solid #0f0;
        color: #0f0;
        cursor: pointer;
    }
</style>
</head>
<body>
<button id="toggleGravity">Toggle Gravity: ON</button>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Comet
let comet = {
    x: canvas.width / 2,
    y: canvas.height / 2,
    vx: 0,
    vy: 0,
    size: 20
};

// Controls
let tiltX = 0;
let tiltY = 0;
let acceleration = 0.1;
let friction = 0.99;

// Planets
let planets = [];
let planetGravityEnabled = true;
document.getElementById("toggleGravity").onclick = () => {
    planetGravityEnabled = !planetGravityEnabled;
    document.getElementById("toggleGravity").innerText = 
        `Toggle Gravity: ${planetGravityEnabled ? 'ON' : 'OFF'}`;
};

// Generate random planets
function generatePlanets(num) {
    planets = [];
    for (let i = 0; i < num; i++) {
        let size = Math.random() * 40 + 20;
        let mass = size * 100; // mass proportional to size
        let color = `hsl(${Math.random() * 360}, 80%, 60%)`;
        let x, y;
        // Avoid spawning too close to the comet
        do {
            x = Math.random() * canvas.width;
            y = Math.random() * canvas.height;
        } while (Math.hypot(x - comet.x, y - comet.y) < 150);

        planets.push({ x, y, size, mass, color });
    }
}
generatePlanets(6);

// Device tilt controls
window.addEventListener("deviceorientation", (e) => {
    tiltX = e.gamma / 45; // left/right
    tiltY = e.beta / 45;  // up/down
});

// Update
function update() {
    // Tilt control
    comet.vx += tiltX * acceleration;
    comet.vy += tiltY * acceleration;

    // Gravity
    if (planetGravityEnabled) {
        planets.forEach(planet => {
            let dx = planet.x - comet.x;
            let dy = planet.y - comet.y;
            let distSq = dx * dx + dy * dy;
            let dist = Math.sqrt(distSq);

            if (dist > planet.size) {
                let force = (planet.mass / distSq) * 0.0005;
                comet.vx += (dx / dist) * force;
                comet.vy += (dy / dist) * force;
            }
        });
    }

    comet.vx *= friction;
    comet.vy *= friction;

    comet.x += comet.vx;
    comet.y += comet.vy;

    // Wrap around screen
    if (comet.x < 0) comet.x = canvas.width;
    if (comet.x > canvas.width) comet.x = 0;
    if (comet.y < 0) comet.y = canvas.height;
    if (comet.y > canvas.height) comet.y = 0;
}

// Draw comet with rock-like kryptonite texture
function drawComet() {
    let gradient = ctx.createRadialGradient(
        comet.x, comet.y, comet.size * 0.2,
        comet.x, comet.y, comet.size
    );
    gradient.addColorStop(0, "#4aff4a");
    gradient.addColorStop(0.7, "#006600");
    gradient.addColorStop(1, "#001a00");

    ctx.fillStyle = gradient;
    ctx.beginPath();
    ctx.arc(comet.x, comet.y, comet.size, 0, Math.PI * 2);
    ctx.fill();

    // Add speckles for rocky look
    for (let i = 0; i < 8; i++) {
        let angle = Math.random() * Math.PI * 2;
        let radius = Math.random() * comet.size * 0.8;
        let sx = comet.x + Math.cos(angle) * radius;
        let sy = comet.y + Math.sin(angle) * radius;
        ctx.fillStyle = "rgba(0,0,0,0.6)";
        ctx.beginPath();
        ctx.arc(sx, sy, Math.random() * 3, 0, Math.PI * 2);
        ctx.fill();
    }
}

// Draw planets
function drawPlanets() {
    planets.forEach(planet => {
        ctx.fillStyle = planet.color;
        ctx.beginPath();
        ctx.arc(planet.x, planet.y, planet.size, 0, Math.PI * 2);
        ctx.fill();
    });
}

// Loop
function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    update();
    drawPlanets();
    drawComet();

    requestAnimationFrame(gameLoop);
}
gameLoop();

window.addEventListener("resize", () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
});
</script>
</body>
</html>
